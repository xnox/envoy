From d0588833d3cfa5b3b1b9b4011e68eebd8942eb01 Mon Sep 17 00:00:00 2001
From: Dimitri John Ledkov <dimitri.ledkov@surgut.co.uk>
Date: Sun, 15 Jun 2025 20:41:47 +0100
Subject: [PATCH] Add back support for BORINGSSL_API_VERSION 31

---
 quiche/quic/core/crypto/tls_server_connection.cc | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/quiche/quic/core/crypto/tls_server_connection.cc b/quiche/quic/core/crypto/tls_server_connection.cc
index 80a3aa79d..39e7dc125 100644
--- a/quiche/quic/core/crypto/tls_server_connection.cc
+++ b/quiche/quic/core/crypto/tls_server_connection.cc
@@ -76,6 +76,7 @@ absl::Status TlsServerConnection::ConfigureSSL(
 void TlsServerConnection::SetCertChain(
     const std::vector<CRYPTO_BUFFER*>& cert_chain,
     const std::string& trust_anchor_id) {
+#if defined(BORINGSSL_API_VERSION) && BORINGSSL_API_VERSION >= 32
   if (GetQuicReloadableFlag(enable_tls_trust_anchor_ids)) {
     QUIC_RELOADABLE_FLAG_COUNT_N(enable_tls_trust_anchor_ids, 1, 2);
     bssl::UniquePtr<SSL_CREDENTIAL> credential(SSL_CREDENTIAL_new_x509());
@@ -101,9 +102,14 @@ void TlsServerConnection::SetCertChain(
 #endif
     SSL_add1_credential(ssl(), credential.get());
   } else {
+#else
+    (void)trust_anchor_id;  // Suppress unused parameter error.
+#endif
     SSL_set_chain_and_key(ssl(), cert_chain.data(), cert_chain.size(), nullptr,
                           &TlsServerConnection::kPrivateKeyMethod);
+#if defined(BORINGSSL_API_VERSION) && BORINGSSL_API_VERSION >= 32
   }
+#endif
 }
 
 void TlsServerConnection::SetClientCertMode(ClientCertMode client_cert_mode) {
-- 
2.48.1

